---
complexity_score: 11.5
converted_at: '2025-08-13T06:58:31.824766Z'
file_type: html
format: html
image_processing_enhanced: true
images_extracted: 4
images_saved: 3
original_path: 542_22104-LZA7016014_1Uen.U.html
pictures_extracted: 4
processing_method: docling_multimodal
quality_score: 9.0
source_file: 542_22104-LZA7016014_1Uen.U.html
source_zip: en_lzn7931071_r38f.zip
tables_extracted: 7
zip_image_types:
- .svg
- .png
- .gif
- .jpg
- .bmp
zip_images_total: 2796
---

# 

Multiple IP Addresses for Security Gateway Resilience

Baseband Radio Node

Contents

![Image](../images/542_22104-LZA7016014_1Uen.U/additional_3_CP.png)

![Image](../images/542_22104-LZA7016014_1Uen.U/additional_3_CP.png)

- Multiple Addresses for Security Gateway Resilience Overview
- Dependencies of Multiple IP Addresses for Security Gateway Resilience
- Multiple IP Addresses for Security Gateway Resilience Operation
- Parameters for Multiple IP Addresses for Security Gateway Resilience
- Network Impact of Multiple IP Addresses for Security Gateway Resilience
- Performance of Multiple IP Addresses for Security Gateway Resilience
- Activate Non-License-Controlled Features
- Engineering Guidelines
    - Configuration in eNodeB
    - Configuration in gNodeB
    - Configuration in Mixed Mode Baseband

# 1 Multiple Addresses for Security Gateway Resilience Overview

This feature supports dual IP addresses for S1 interface to be used with

active-active IPsec VPNs to primary and secondary SEGs, for resilient connectivity to the

core.

| Feature Name           | Multiple IP Addresses for Security Gateway Resilience   | Multiple IP Addresses for Security Gateway Resilience   |
|------------------------|---------------------------------------------------------|---------------------------------------------------------|
| Feature Identity       | FAJ 121 5376                                            | FAJ 121 5376                                            |
| Value Package Name     | NR Base Package                                         | LTE Base Package                                        |
| Value Package Identity | FAJ 801 4002                                            | FAJ 801 0400                                            |
| Node Type              | Baseband Radio Node                                     | Baseband Radio Node                                     |
| Access Type            | NR                                                      | LTE                                                     |
| Licensing              | Non-license-controlled feature. No license is required. | Non-license-controlled feature. No license is required. |

Summary

With this feature, separate local S1 IP addresses are used for primary and secondary

connections. Each S1 address is tied to a separate IPsec VPN and SEG. The feature

supports the following SEG resilience:

- The primary S1-U address and the corresponding SEG are chosen if they are available. If a failure of the primary IPsec VPN is detected by the DPD mechanism in Baseband, a failover to the secondary S1-U address and SEG is performed.
- A smooth recovery of the S1-U traffic from the secondary SEG to the primary SEG is supported when the primary IPsec VPN is reestablished. The existing UEs retain on the secondary S1-U address and SEG while new connected UEs use the primary S1-U address and SEG.
- Existing SCTP multihoming mechanism is used with two local S1-C addresses.

With this feature, both uplink and downlink S1-U traffic is switched based on the DPD

in the Baseband unit. Thus, in networks with slow DPD in the primary SEG, the

downtime for S1-U traffic is reduced in case of path failure for the primary IPsec

VPN.

# 2 Dependencies of Multiple IP Addresses for Security Gateway Resilience

IPsec is prerequisite for this feature.

Table 1   Feature Dependencies

| Feature              | Relationship   | Description                                                                                                               |
|----------------------|----------------|---------------------------------------------------------------------------------------------------------------------------|
| IPsec (FAJ 121 0804) | Prerequisite   | This feature is supported in a node deployed in an untrusted network                                 together with IPsec. |

Hardware

No special hardware requirement is expected for this feature.

Limitations

The feature has the following limitations:

- The feature only works on a Baseband unit in an untrusted environment together with IPsec and the configuration that is described in Engineering Guidelines.
- The feature applies to the S1 interface for LTE and EN-DC. The feature is not supported for NG interface in NR SA.
- On gNodeBs, the feature is supported if the anchor eNodeB is from Ericsson and direct IPsec is used for EN-DC X2.
- There is no IP redundancy for the X2 interface. If X2 uses the same IP address as the primary S1, the following options apply for primary IPsec VPN failure: Existing X2-C connections are lost, unless the direct IPsec VPN is established with the X2 neighbor and the same IP addresses are used for X2-U and X2-C. An existing internal EN-DC X2-C connection between LTE and NR in a mixed mode Baseband is maintained. No new X2-C connections are established, until the primary IPsec VPN recovers. If the EN-DC X2-C connections are lost for a gNodeB, for example at node restart, the gNodeB is not able to handle the EN-DC traffic until the primary IPsec VPN recovers. The same apply in a mixed mode Baseband.
- This feature is supported in Baseband units without address separation for each PLMN. In a shared RAN configuration where additional PLMNs use separate S1-U IP addresses, this feature is supported for the primary PLMN.
- The maximum number of PBR rules on each IP version is 16. Therefore the feature works with up to 16 SGWs or SGW subnets for each Baseband unit.
- For EN-DC, the X2AP Secondary Node release procedure is used to release S1 bearers when switching to the secondary S1-U. The X2AP partial reset of EN-DC procedure is not supported.
- On gNodeBs, switching to backup S1-U can be triggered either by primary IPsec VPN failure or by GTP-U path monitoring function.
- On eNodeBs, switching to backup S1-U can be triggered only by primary IPsec VPN failure.

Network Requirements

Each SEG must advertise route to one of the S1 IP addresses in the Baseband unit,

based on the IPsec traffic selectors sent by the Baseband unit.

# 3 Multiple IP Addresses for Security Gateway Resilience Operation

For resilient connectivity to the core, the feature allows dual IP addresses for S1

interface to be used with active-active IPsec VPNs to primary and secondary

SEGs.

With this feature, two local S1-U addresses are configured in the primary-backup mode.

Both are configured in the same virtual router and with the same IP version. The primary

and the secondary S1 addresses are tied to separate IPsec VPN and SEG.

The IPsec traffic selector configuration in the Baseband unit allows traffic for one S1

address in each IPsec VPN. Each SEG advertises route to one of the S1 addresses in the

Baseband unit based on the IPsec traffic selectors sent by the Baseband unit.

Figure 1   SEG Resiliency For eNodeB or gNodeB

Table 2   Routing Table in the inner Router

| Routing Type              | Destination     | Source   | Next Hop   |
|---------------------------|-----------------|----------|------------|
| Policy Based Routing      | SGW             | IP2      | IPsec VPN2 |
| Destination Based Routing | MME IP2         | -        | IPsec VPN2 |
| Destination Based Routing | SGW(1)          | -        | IPsec VPN1 |
| Destination Based Routing | MME IP1(1)      | -        | IPsec VPN1 |
| Destination Based Routing | X2-neighbors(1) | -        | IPsec VPN1 |

(1)

These three routes, with specific destination SGW, MME IP1,

and X2-neighbors, can be replaced by one default route which

leads all remaining traffic to IPsec VPN 1.

The primary S1-U address and corresponding IPsec VPN are chosen if they are available. If

a failure of the primary IPsec VPN is detected by the DPD mechanism in the Baseband

unit, UEs using the primary S1-U address and IPsec VPN are released. Then the S1-U

traffic is switched to the secondary S1-U address and IPsec VPN.

A smooth recovery of S1-U traffic to the primary S1-U address is supported if the primary

IPsec VPN is reestablished. The existing UEs retain on the secondary S1-U address and

IPsec VPN, and the new UEs use the primary S1-U address and IPsec VPN.

The smooth recovery is enabled by the PBR based on both source and destination IP

addresses. The destination-based routing is used to reach the SGW through the primary

IPsec VPN, while the PBR is used to reach the SGW through the secondary IPsec VPN.

For eNodeBs, existing SCTP multihoming is used with the two local S1 addresses and two

MME addresses for S1-C. The local S1-C addresses are tied to each IPsec VPN in the same

way as S1-U. The same local addresses can be used for S1-C and S1-U, or different

addresses can be used.

In case of path failure for the primary S1-C address, the SCTP association switches to

use the secondary S1-C address and path.

For gNodeBs, to be able to switch between the primary and backup S1-U addresses, the

EN-DC X2 connection to the anchor eNodeB must be maintained. To achieve this, the same

address is used for X2-U and X2-C and the direct X2 IPsec is enabled between the eNodeB

and gNodeB.

If the same address is used for X2-U and X2-C and a direct IPsec VPN is established to a

neighbor node, all X2 traffic uses the direct connection. Thus, already established X2-C

connections are not dependent on the IPsec VPN to the SEG. However, new X2-C connections

cannot be established when the IPsec VPN to the SEG is down.

In a mixed mode Baseband with LTE and NR, separate addresses are used for the two

standards. When LTE and NR share the inner VR, the S1 addresses for one standard are

configured using the tunnel interfaces for the primary and secondary IPsec VPN. The S1

addresses for the other standard are configured using loopback interfaces with interface

state tracking to the corresponding tunnel interfaces.

Figure 2   SEG Resiliency For Mixed Mode Baseband

Table 3   Routing Table in the inner Router

| Routing Type              | Destination     | Source   | Next Hop   |
|---------------------------|-----------------|----------|------------|
| Policy Based Routing      | SGW             | IP2      | IPsec VPN2 |
| Policy Based Routing      | SGW             | IP4      | IPsec VPN2 |
| Destination Based Routing | MME IP2         | -        | IPsec VPN2 |
| Destination Based Routing | SGW(2)          | -        | IPsec VPN1 |
| Destination Based Routing | MME IP1(2)      | -        | IPsec VPN1 |
| Destination Based Routing | X2-neighbors(2) | -        | IPsec VPN1 |

(2)

These three routes, with specific destination SGW, MME IP1,

and X2-neighbors, can be replaced by one default route which

leads all remaining traffic to IPsec VPN 1.

Interface state tracking allows loopback interface in the inner router to inherit the

state of an IPsec tunnel interface. Thus, the loopback interface operational state can

be updated based on the tracked IP interface operational status.

Internal EN-DC X2 traffic between LTE and NR in the mixed mode Baseband can be maintained

when the primary IPsec VPN goes down.

# 4 Parameters for Multiple IP Addresses for Security Gateway Resilience

The Multiple IP Addresses for Security Gateway Resilience feature introduces new MOM

attributes to configure the feature.

Table 4   Feature Configuration Parameters

| Parameter                       | Type       | Description          |
|---------------------------------|------------|----------------------|
| ENodeBFunction.upIpAddress2Mode | Introduced | See MOM description. |
| LocalIpEndpoint.mode            | Introduced | See MOM description. |

# 5 Network Impact of Multiple IP Addresses for Security Gateway Resilience

Capacity and Performance

No impact.

Interfaces

No impact.

Other Network Elements

To fully benefit from the change, the node requires support from the following

network elements:

- Based on the IPsec traffic selectors sent by the Baseband unit, each SEG must advertise route to one of the S1 IP addresses in the Baseband unit.
- This feature is supported from ENM version 21.16.

# 6 Performance of Multiple IP Addresses for Security Gateway Resilience

Key Performance Indicators

This feature has no associated KPIs.

Counters

![Image](../images/542_22104-LZA7016014_1Uen.U/additional_3_CP.png)

![Image](../images/542_22104-LZA7016014_1Uen.U/additional_3_CP.png)

This feature has no associated counters.

Events

This feature has no associated events.

# 7 Activate Non-License-Controlled Features

Non-license-controlled features do not require manual activation and cannot be

deactivated.

While license-controlled features need to be activated, non-license-controlled features

are activated automatically during node integration. They also do not

have

a software license key associated, which means that they have no

entries in the LKF that is installed on the node.

In some cases, non-license-controlled features need to be configured

manually or have some of

their

subfunctions enabled to work properly.

# 8 Engineering Guidelines

## 8.1 Configuration in eNodeB

Figure 3 illustrates the suggested IPsec

configuration in eNodeB when using IPv4. IPv6 can be used instead in inner and outer

network independently.

Figure 3   Configuration in eNodeB

In the configuration in eNodeB, the following important details must be considered:

1. Two IPsec VPNs are configured, one to the primary SEG and the other to the secondary SEG. Each IPsec VPN includes the following MOs: IpsecTunnel IpsecPolicy PeerIPv4 Tunnel InterfaceIPv4 The same local outer address can be used. Each of the two local inner addresses, like the IP1 and IP2 in the example, is tied to one of the IPsec VPNs. The addresses are configured using AddressIPv4 MOs as children to the tunnel InterfaceIPv4 MOs. Each of the addresses has the same operational state as the tunnel InterfaceIPv4 MO and depends on the state of the IPsec VPN. The IpsecPolicy.localTrafficSelector attribute for each IPsec VPN includes the local inner address for the IPsec VPN. Only traffic for the relevant inner address is allowed through the IPsec VPN. The SEG can publish route in the trusted network based on traffic selector sent by the Baseband unit. For more information about the configuration of the IPsec, see Manage IPsec.
2. A static route to the second MME address and a PBR to the SGW for IP2 are configured with the NextHop.reference attribute to the secondary tunnel InterfaceIPv4 MO. A default static route is configured with the NextHop.reference attribute to the primary tunnel InterfaceIPv4 MO. This route is used for traffic: To the first MME address To the SGW from IP1 To all X2 neighbors For more information about PBR configuration, see Manage Routing Features.
3. Two SctpEndpoint MOs are configured, one for S1-C and the other for X2-C. The SctpEndpoint MO for the S1-C is multi-homed with two local addresses and two MME addresses. There are four paths within the association, but only the path between IP1 and MME1 and the path between IP2 and MME2 can be used. The cross paths between IP1 and MME2, and between IP2 and MME1 are blocked by the routing and the traffic selectors. In this example, the same addresses are used for S1-C and S1-U. It is also possible to use separate addresses for S1-C. These can be configured using loopback InterfaceIPv4 MOs in the same Router MO, and separate IpsecPolicy MOs with the addresses in the IpsecPolicy.localTrafficSelector attribute for the relevant IPsec VPN. The SctpEndpoint MO for X2-C is single-homed. In this example, the same address is used for X2 and primary S1. It is also possible to use a separate address for X2. This can be configured in the same way as a separate address for S1-C.
4. Two S1-U addresses are configured in backup mode with the following settings. The ENodeBFunction.upIpAddressRef attribute refers to the primary AddressIPv4 MO. The ENodeBFunction.upIpAddress2Ref attribute refers to the secondary AddressIPv4 MO. The ENodeBFunction.upIpAddress2Mode attribute is set to BACKUP.
5. To maintain X2 when IPsec VPN to SEG fails for X2, the same address must be used for X2-C and X2-U and direct IPsec must be enabled. Maintaining LTE X2 is not necessary. But if the eNodeB is an anchor node for a gNodeB, the EN-DC X2 must be maintained. Direct IPsec is enabled for both LTE X2 and EN-DC X2 by configuring the ENodeBFunction.ipsecEpAddressRef attribute, or for EN-DC X2 only by configuring the ENodeBFunction.ipsecEndcEpAddressRef attribute.

## 8.2 Configuration in gNodeB

Figure 4 illustrates the suggested configuration

in gNodeB when using IPv4. IPv6 can be used instead in inner and outer network

independently.

Figure 4   Configuration in gNodeB

The configuration in the gNodeB is the same as the configuration in the eNodeB with the

following relevant differences:

1. There is no route to the MME because there is no S1-C in this configuration.
2. There is only one SctpEndpoint MO because there is no S1-C in this configuration, that is for X2-C.
3. The configuration of the two S1-U addresses in backup mode in gNodeB is different from the configuration in eNodeB. There are two LocalIpEndpoint MOs for the EndpointResource MO with S1 in the interfaceList. The LocalIpEndpoint.mode attribute for one of them is set to BACKUP. When not in backup mode, the LocalIpEndpoint.addressRef attribute refers to the primary AddressIPv4 MO. When in backup mode, the LocalIpEndpoint.addressRef attribute refers to the secondary AddressIPv4 MO. Note: The EndpointResource MO must not be referred by any ResourcePartitionMember MOs.
4. The EN-DC X2 connection to the anchor eNodeB must be maintained when primary IPsec VPN to SEG fails. To maintain the EN-DC X2 connection, the same address must be used for X2-C and X2-U, and the direct IPsec must be enabled by configuring the LocalIpsecEndPoint MO.

## 8.3 Configuration in Mixed Mode Baseband

Figure 5 illustrates the suggested Transport

Network (TN) configuration in mixed mode Baseband with LTE and NR sharing inner Virtual

Router (VR) when using IPv4. IPv6 can be used instead in inner and outer network

independently.

Figure 5   Configuration in Mixed Mode Baseband

The following differences apply to the TN configuration compared to eNodeB:

1. LTE and NR use different local inner addresses and two more addresses need to be configured in the inner Router MO, which are IP3 and IP4 in this example. These additional addresses are configured using loopback InterfaceIPv4 MOs. The state of the IPsec VPN is reflected by IP3 and IP4 by configuring the InterfaceIPv4.trackedInterface attribute for the loopback InterfaceIPv4 MOs.
2. A second IpsecPolicy MO is needed for each IPsec VPN with the additional address in the IpsecPolicy.localTrafficSelector attribute. If the LTE and NR addresses are in the same subnet, one IpsecPolicy MO can be used and the IpsecPolicy.localTrafficSelector attribute is a subnet including both addresses.
3. A second PBR is needed for the additional secondary local inner address, that is IP4. If the LTE and NR addresses are in the same subnet, one PBR can be used and the RoutingRulIpv4.addSrc attribute is a subnet including both addresses.

LTE configuration is the same as in eNodeB.

NR configuration is the same as in gNodeB with the difference that

AddressIPv4 MOs for IP3 and IP4 are referred instead of

AddressIPv4 MOs for IP1 and IP2.

Figure 6 illustrates suggested TN configuration

in mixed mode Baseband with LTE and NR sharing inner VR when LTE uses IPv4 and NR uses

IPv6. IPv4 is used in the outer network, but IPv6 can be used instead.

Figure 6   Configuration in Mixed Mode Baseband, LTE Uses IPv4 and NR Uses IPv6

The following differences apply to the TN configuration compared to a mixed mode Baseband

where LTE and NR use the same IP version:

1. A tunnel InterfaceIPv6 MO is added to each IPsec VPN. The addresses used by NR are configured as children to the tunnel InterfaceIPv6 MOs instead of using loopback InterfaceIPv4 MOs.
2. An IPv6 address is needed for the EN-DC X2 on the LTE side, that is IP5 in this example. This is configured using a loopback InterfaceIPv6 MO and AddressIPv6 MO. The InterfaceIPv6.trackedInterface attribute is not configured for this loopback InterfaceIPv6 MO as the state of the IPsec VPN is not relevant for X2.
3. A third IpsecPolicy MO is needed for the IPsec VPN used for EN-DC X2 with the additional address in the IpsecPolicy.localTrafficSelector attribute. If the IPv6 addresses are in the same subnet, one IpsecPolicy MO can be used for IPv6 and the IpsecPolicy.localTrafficSelector attribute is a subnet including both addresses. Separate IpsecPolicy MOs must be used for IPv4 and IPv6.
4. The same static routes and PBR are added for IPv6 as for IPv4.

LTE configuration is the same as in eNodeB with the addition that the

ENodeBFunction.upEndcX2AddressRef attribute refers to the

separate AddressIPv6 MO, configured using a loopback

InterfaceIPv6 MO.

NR configuration is the same as in gNodeB with the difference that

AddressIPv6 MOs for IP3 and IP4 are referred instead of

AddressIPv4 for IP1 and IP2.